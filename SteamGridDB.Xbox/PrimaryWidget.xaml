<Page
    x:Class="SteamGridDB.Xbox.PrimaryWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:SteamGridDB.Xbox"
    xmlns:models="using:SteamGridDB.Xbox.Models"
    xmlns:converters="using:SteamGridDB.Xbox.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Padding="10" Background="{ThemeResource SystemControlBackgroundAccentBrush}">
            <TextBlock Text="SteamGridDB - Game Library" 
                FontSize="16" 
                FontWeight="Bold" 
                Foreground="White"/>
        </StackPanel>

        <!-- Game entries list -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid>
                <!-- Instructions panel (shown when no games loaded) -->
                <StackPanel x:Name="InstructionsPanel" 
                    Padding="20"
                    Visibility="Collapsed">
                    <TextBlock Text="📁 Access Required" 
                        FontSize="16" 
                        FontWeight="Bold"
                        Margin="0,0,0,10"/>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="0,0,0,10">
                        To access your game library, you need to grant file system permission:
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="10,0,0,5">
                        1. Open Windows Settings
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="10,0,0,5">
                        2. Go to Privacy &amp; Security &gt; File system
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="10,0,0,5">
                        3. Enable file system access for this app
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="10,0,0,5">
                        4. Click Refresh below
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" 
                        Margin="0,10,0,0"
                        Opacity="0.7">
                        Expected folder: %LOCALAPPDATA%\Packages\Microsoft.GamingApp_8wekyb3d8bbwe\LocalState\ThirdPartyLibraries
                    </TextBlock>
                </StackPanel>

                <!-- Game entries ListView -->
                <ListView x:Name="GameEntriesListView" 
                    ItemsSource="{x:Bind GameEntries}"
                    SelectionMode="None"
                    IsItemClickEnabled="False">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:GameEntry">
                            <Grid Padding="8" Margin="4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Game image -->
                                <Border Grid.Column="0" 
                                    Width="50" 
                                    Height="50" 
                                    Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
                                    CornerRadius="4">
                                    <Grid>
                                        <Image Source="{x:Bind Image, Mode=OneWay}" 
                                            Stretch="UniformToFill"
                                            Visibility="{x:Bind ImageVisibility, Mode=OneWay}"/>
                                        <TextBlock Text="?" 
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Center"
                                            FontSize="20"
                                            Visibility="{x:Bind PlaceholderVisibility, Mode=OneWay}"/>
                                    </Grid>
                                </Border>

                                <!-- Game info -->
                                <StackPanel Grid.Column="1" 
                                            Margin="10,0,0,0" 
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{x:Bind ImageName, Mode=OneWay}" 
                                        FontWeight="SemiBold" 
                                        FontSize="14"
                                        TextWrapping="NoWrap"
                                        TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{x:Bind Id, Mode=OneWay}" 
                                        FontSize="11" 
                                        Opacity="0.7"
                                        TextWrapping="NoWrap"
                                        TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{x:Bind Directory, Mode=OneWay}" 
                                        FontSize="10" 
                                        Opacity="0.5"
                                        TextWrapping="NoWrap"
                                        TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </ScrollViewer>

        <!-- Status bar -->
        <StackPanel Grid.Row="2" 
                    Padding="10" 
                    Background="{ThemeResource SystemControlBackgroundBaseLowBrush}">
            <TextBlock x:Name="StatusText" 
                Text="Loading..." 
                FontSize="12" 
                Opacity="0.7"/>
            <Button x:Name="refreshButton" 
                    Click="RefreshButton_Click" 
                    Margin="0,5,0,0">
                Refresh
            </Button>
        </StackPanel>
    </Grid>
</Page>
